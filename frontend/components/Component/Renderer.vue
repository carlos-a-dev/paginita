<template>
  <component
    :is="component"
    v-if="component"
    :class="props.classList?.class ?? []"
  />
</template>

<script setup lang="ts">
import type { Component } from '~/types/strapi/strapi'

const props = defineProps<Component & {
  lazy?: boolean
  classList?: {
    id: number
    class: string[]
  }
}>()

const component = computed(() => {
  const key = props.__component

  if (!key || !key.startsWith('f.')) return null

  // Convert "f.section-title" to "SectionTitle"
  const componentName = (props.lazy ? 'Lazy' : '') + key
    .replace('.', '-')
    .split('-')
    .map(part => part.charAt(0).toUpperCase() + part.slice(1))
    .join('')

  // Eager fallback for already-loaded/auto-imported component
  try {
    const component = resolveComponent(componentName)
    console.debug(`[DynamicComponent] Loaded component: ${componentName}`)
    return typeof component === 'string' ? null : componentName
  }
  catch (err) {
    console.warn(`[DynamicComponent] Component not found: ${componentName}`)
    console.warn(err)
    return null
  }
})
</script>
